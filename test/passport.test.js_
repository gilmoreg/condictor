/* eslint-disable no-unused-vars */
/* eslint-disable no-unused-expressions */
/* eslint-disable no-undef */
const chai = require('chai');
const mongoose = require('mongoose');

const { app, runServer, closeServer } = require('../server');

const TEST_DATABASE_URL = process.env.TEST_DATABASE_URL;
const should = chai.should();

const tearDownDb = () => mongoose.connection.dropDatabase();

describe('Passport', () => {
  before(() => runServer(TEST_DATABASE_URL));
  afterEach(() => tearDownDb());
  after(() => closeServer());

  it('should create a new user and sign in', (done) => {
    chai.request(app)
      .post('/auth/signup')
      .send({ username: 'admin', password: 'test' })
      .then((res) => {
        res.should.have.status(201);
        res.should.be.json;
        res.body.should.be.a('object');
        res.body.username.should.equal('admin');
        done();
      });
  });
});
